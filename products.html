<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·∫£n ph·∫©m - Flora Shop</title>
    <style>
      body { font-family:"Segoe UI",sans-serif; margin:0; background:#f9f9f9; }
      header { display:flex; justify-content:space-between; align-items:center; background:#4caf50; color:white; padding:10px 20px; position:sticky; top:0; z-index:100; }
      header h1 { margin:0; font-size:22px; text-align:center; flex:1; }
      .home-btn { background:white; color:#4caf50; border-radius:5px; padding:4px 8px; text-decoration:none; font-weight:bold; }
      .user-info { display:flex; align-items:center; gap:10px; font-size:16px; }
      .user-info button { background:white; border:none; border-radius:5px; padding:4px 8px; cursor:pointer; }
      .cart-link { position:relative; color:white; text-decoration:none; font-weight:bold; }
      .cart-count { position:absolute; top:-6px; right:-10px; background:red; color:white; font-size:12px; width:18px; height:18px; border-radius:50%; display:flex; justify-content:center; align-items:center; }
      .filter-bar { display:flex; gap:10px; padding:20px; flex-wrap:wrap; }
      .filter-bar input, .filter-bar select, .filter-bar button { padding:8px; border-radius:5px; border:1px solid #ccc; }
      #product-list { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; padding:0 20px 20px 20px; }
      .product-card { background:white; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; text-align:center; transition:transform 0.2s; }
      .product-card:hover { transform:translateY(-3px); }
      .product-card img { width:100%; height:160px; object-fit:cover; border-radius:8px; cursor:pointer; }
      .product-card h3 { margin:10px 0 5px; }
      .price { color:#4caf50; font-weight:bold; }
      .add-btn { background:#4caf50; color:white; border:none; border-radius:5px; padding:6px 12px; cursor:pointer; margin-top:5px; }
      .pagination-info { text-align:center; margin-top:20px; font-weight:bold; }
      .pagination-buttons { text-align:center; margin-top:10px; }
      .page-btn { background:#eee; border:none; padding:8px 12px; margin:3px; border-radius:6px; cursor:pointer; transition: background 0.2s; }
      .page-btn.active { background:#4caf50; color:white; }
      .page-btn:hover { background:#bde5c8; }
      @media (max-width: 900px) { #product-list { grid-template-columns: repeat(2,1fr); } }
      @media (max-width: 600px) { #product-list { grid-template-columns: repeat(1,1fr); } }
    </style>
  </head>
  <body>

    <header>
      <a href="index.html" class="home-btn">üè† Trang ch·ªß</a>
      <h1>üå∏ Flora Shop</h1>
      <div class="user-info" id="user-info">
        <span id="username"></span>
        <button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
        <a href="cart.html" class="cart-link">
          üõí Gi·ªè h√†ng <span id="cart-count">0</span>
        </a>
      </div>
    </header>

    <div class="filter-bar">
      <input id="search" placeholder="T√¨m theo t√™n..." />
      <select id="category">
        <option value>T·∫•t c·∫£ lo·∫°i</option>
        <option value="Hoa">Hoa</option>
        <option value="C√¢y c·∫£nh">C√¢y c·∫£nh</option>
      </select>
      <select id="priceRange">
        <option value>T·∫•t c·∫£ gi√°</option>
        <option value="0-100000">D∆∞·ªõi 100.000</option>
        <option value="100000-200000">100.000 - 200.000</option>
        <option value="200000-500000">200.000 - 500.000</option>
        <option value="500000-9999999">Tr√™n 500.000</option>
      </select>
      <button id="filterBtn">L·ªçc</button>
    </div>

    <div id="product-list"></div>
    <div id="pagination"></div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if(!currentUser) {
          alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!');
          location.href = 'login.html';
          return;
        }
        // üå∏ D·ªØ li·ªáu s·∫£n ph·∫©m m·∫´u (·∫£nh JPG)
        const defaultProducts = [
          {id:1,name:'Hoa h·ªìng',category:'Hoa',price:120000,desc:'Hoa h·ªìng ƒë·∫πp', img:'assets/img/id1.jpg'},
          {id:2,name:'Hoa h∆∞·ªõng d∆∞∆°ng',category:'Hoa',price:90000,desc:'R·∫°ng r·ª° t·ªèa n·∫Øng', img:'assets/img/id2.jpg'},
          {id:3,name:'C√¢y ph√°t t√†i',category:'C√¢y c·∫£nh',price:250000,desc:'Mang l·∫°i may m·∫Øn', img:'assets/img/id3.jpg'},
          {id:4,name:'Hoa tulip',category:'Hoa',price:150000,desc:'Thanh l·ªãch v√† tinh t·∫ø', img:'assets/img/id4.jpg'},
          {id:5,name:'Hoa lan',category:'Hoa',price:200000,desc:'Bi·ªÉu t∆∞·ª£ng sang tr·ªçng', img:'assets/img/id5.jpg'},
          {id:6,name:'Hoa c√∫c',category:'Hoa',price:80000,desc:'ƒê∆°n gi·∫£n m√† ƒë√°ng y√™u', img:'assets/img/id6.jpg'},
          {id:7,name:'C√¢y bonsai',category:'C√¢y c·∫£nh',price:350000,desc:'Ngh·ªá thu·∫≠t thu nh·ªè thi√™n nhi√™n', img:'assets/img/id7.jpg'},
          {id:8,name:'C√¢y sen ƒë√°',category:'C√¢y c·∫£nh',price:100000,desc:'D·ªÖ chƒÉm, b·ªÅn b·ªâ', img:'assets/img/id8.jpg'},
          {id:9,name:'Hoa m·∫´u ƒë∆°n',category:'Hoa',price:180000,desc:'Sang tr·ªçng v√† qu√Ω ph√°i', img:'assets/img/id9.jpg'},
          {id:10,name:'C√¢y may m·∫Øn',category:'C√¢y c·∫£nh',price:220000,desc:'Mang l·∫°i t√†i l·ªôc', img:'assets/img/id10.jpg'},
          {id:11,name:'Hoa ly',category:'Hoa',price:190000,desc:'Tinh khi·∫øt v√† thanh cao', img:'assets/img/id11.jpg'},
          {id:12,name:'Hoa c·∫©m t√∫ c·∫ßu',category:'Hoa',price:210000,desc:'Ng·ªçt ng√†o v√† nh·∫π nh√†ng', img:'assets/img/id12.jpg'}
        ];

        if(!localStorage.getItem('products')) 
          localStorage.setItem('products', JSON.stringify(defaultProducts));

        const list = document.getElementById('product-list');
        const search = document.getElementById('search');
        const category = document.getElementById('category');
        const priceRange = document.getElementById('priceRange');
        const filterBtn = document.getElementById('filterBtn');
        const paginationContainer = document.getElementById('pagination');
        const cartCount = document.getElementById('cart-count');
        const ITEMS_PER_PAGE = 6;
        let currentPage = 1;
        let filteredProducts = JSON.parse(localStorage.getItem('products'));

        function getProductImage(p){
          return p.img || `assets/img/id${p.id}.jpg`;
        }

        function updateCartCount(){
          const key = `cart_${currentUser.username}`;
          const cart = JSON.parse(localStorage.getItem(key) || '[]');
          cartCount.textContent = cart.reduce((s,i)=>s+i.qty,0);
        }

        function addToCart(id){
          const key = `cart_${currentUser.username}`;
          const products = JSON.parse(localStorage.getItem('products'));
          const prod = products.find(p=>p.id===id);
          let cart = JSON.parse(localStorage.getItem(key) || '[]');
          const exist = cart.find(i=>i.id===id);
          if(exist) exist.qty++;
          else cart.push({...prod, qty:1});
          localStorage.setItem(key, JSON.stringify(cart));
          updateCartCount();
          alert(`‚úÖ ƒê√£ th√™m "${prod.name}" v√†o gi·ªè h√†ng!`);
        }

        function display(products){
          const start = (currentPage-1)*ITEMS_PER_PAGE;
          const end = start+ITEMS_PER_PAGE;
          const items = products.slice(start, end);
          list.innerHTML = items.map(p=>`
            <div class="product-card">
              <img src="${getProductImage(p)}" alt="${p.name}" 
                   onclick="window.location.href='detail.html?id=${p.id}'" 
                   onerror="this.src='assets/img/placeholder.jpg'">
              <h3>${p.name}</h3>
              <p>${p.desc}</p>
              <p class="price">${p.price.toLocaleString()} VNƒê</p>
              <button class="add-btn" data-id="${p.id}">üõí Th√™m v√†o gi·ªè</button>
            </div>`).join('');
          document.querySelectorAll('.add-btn').forEach(btn=>btn.addEventListener('click',()=>addToCart(Number(btn.dataset.id))));
          renderPagination(products.length);
        }

        function renderPagination(totalItems){
          const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
          if(totalPages <= 1) { paginationContainer.innerHTML = ''; return; }
          let html = `<div class="pagination-info">Trang ${currentPage} / ${totalPages} (${totalItems} s·∫£n ph·∫©m)</div>`;
          html += '<div class="pagination-buttons">';
          for(let i=1; i<=totalPages; i++){
            html += `<button class="page-btn ${i===currentPage?'active':''}" data-page="${i}">${i}</button>`;
          }
          html += '</div>';
          paginationContainer.innerHTML = html;
          paginationContainer.querySelectorAll('.page-btn').forEach(btn=>btn.addEventListener('click',e=>{
            currentPage = Number(e.target.dataset.page);
            display(filteredProducts);
          }));
        }

        function filterProducts(){
          const all = JSON.parse(localStorage.getItem('products'));
          const kw = (search.value||'').toLowerCase();
          const cat = category.value;
          const price = priceRange.value;
          filteredProducts = all.filter(p=>{
            const matchName = p.name.toLowerCase().includes(kw);
            const matchCat = cat ? p.category===cat : true;
            let matchPrice = true;
            if(price){
              const [min,max] = price.split('-').map(Number);
              matchPrice = p.price >= min && p.price <= max;
            }
            return matchName && matchCat && matchPrice;
          });
          currentPage = 1;
          display(filteredProducts);
        }

        // L·ªçc khi b·∫•m n√∫t ho·∫∑c g√µ Enter
        filterBtn.addEventListener('click', filterProducts);
        search.addEventListener('keyup', e => { if(e.key === 'Enter') filterProducts(); });

        display(filteredProducts);
        updateCartCount();
      });
    </script>

  </body>
</html>